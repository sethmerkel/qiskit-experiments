---
features:
  - |
    Added ``backend``, ``analysis``, and ``target`` init kwargs to the
    :class:`~.StateTomography` and :class:`~.ProcessTomography` experiments.
    These allow specifying the intended backend, a custom analysis class, or a
    custom target for fidelity calculations when initializing the experiments.
  - |
    Improved :class:`.LocalMeasurementBasis` and :class:`.LocalPreparationBasis`
    tomography basis classes support for initializing a noisy basis for
    performing state preparation and measurement error mitigated
    :class:`.StateTomography` and :class:`.ProcessTomography` experiments.

    For preparation bases, a noisy reset operation on a specific qubit,
    or subset of qubits, can now be input as a quantum channel, and the
    noisy prepared states are generated by applying the ideal instructions
    to the noisy initial state.

    For measurement bases, a noisy POVM or quantum channel can be supplied for
    the 0-index basis (typically the Z-basis), and other bases index POVMs will
    be generated by applying the ideal inverse instructions to the noisy POVMS.
  - |
    Added an optional ``mitigator`` kwarg to :class:`.PauliMeasurementBasis`
    which can be used to initialize the basis with a
    :class:`~qiskit.result.LocalReadoutMitigator` to construct a readout error mitigated
    basis for use with :class:`.StateTomography` and
    :class:`.ProcessTomography` experiments.
  
    The :class:`.LocalReadoutError` experiment can be run to obtain the 
    :class:`~qiskit.result.LocalReadoutMitigator` from its analysis results.
  - |
    Added readout error mitigated tomography experiments
    :class:`.MitigatedStateTomography` and :class:`.MitigatedProcessTomography`.
    These are both implemented as a :class:`.BatchExperiment` consisting of a
    :class:`.LocalReadoutError` characterization experiment followed by either
    a :class:`.StateTomography` or :class:`.ProcessTomography` experiment.
  - |
    Added support for conditional tomographic reconstruction to the
    :class:`.StateTomography` and :class:`.ProcessTomography` experiments.

    There are three types of conditioning that can be used independently
    or together in any combination for reconstruction of a state or
    channel as a list of components conditional on these values.
    
    The ``conditional_circuit_clbits`` init option can be used to
    specify any subset of clbits in an tomography circuit containing
    clbits to be conditioned on when peforming the tomographic
    reconstruction. The conditioning outcome value of the clbits is
    stored in the analysis results ``extra`` field.

    The ``conditional_measurement_indices`` analysis option can be used
    to condition on the measurement basis index and outcome value of a
    specific subset of tomographic basis measurements. The conditioning
    basis index and outcome value are both stored in the analysis
    results ``extra`` field.

    The ``conditional_preparation_indices`` analysis option can be used
    to condition on the preparation basis index of a specific subset of
    tomographic basis preprations. The conditioning basis index is stored
    in the analysis results ``extra`` field.
  - |
    Adds an option to :class:`~.StateTomographyAnalysis` and
    :class:`~.ProcessTomographyAnalysis` to bootstrap error bars on state
    and process fidelity analysis results. This can be activated by setting
    the ``target_bootstrap_samples`` analysis option to a value.

    Note that bootstrapping involves re-running the full tomography fit on
    re-samples of tomography outcome data for each measurement basis and
    hence the total analysis time will increase linearly with the number
    of bootstrap samples.
fixes:
  - |
    Fixed bug in :class:`~.StateTomography` and :class:`~.ProcessTomography`
    experiments where if the input circuit contained conditional instructions
    with multiple classical registers the tomography measurement circuits
    would contain incorrect conditionals due to a bug in the
    :meth:`qiskit.circuit.QuantumCircuit.compose` method.

    See `Issue #942 <https://github.com/Qiskit-Extensions/qiskit-experiments/issues/943>`_
    for additional details.
upgrade:
  - |
    Renamed the ``qubits``, ``measurement_qubits``, and ``preparation_qubits``
    init kwargs of :class:`~.StateTomography`,
    :class:`~.ProcessTomography`, and :class:`.TomographyExperiment` to
    ``physical_qubits``, ``measurement_indices`` and ``preparation_indices``
    respectively. This is to make the intended use of these kwargs more clear
    as the measurement and preparation args refer to the index of circuit
    qubits in the physical qubits list, not the physical qubit values
    themselves.
  - |
    The automatic overriding of the default CVXPY SDP solver for the
    :func:`.cvxpy_gaussian_lstsq` and :func:`.cvxpy_linear_lstsq` has been disabled
    and will now use the default SDP solver of CVXPY unless a custom solver
    is set using the ``fitter_options`` analysis options.
  - |
    The ``weights`` kwarg of the :func:`.cvxpy_linear_lstsq` and
    :func:`.scipy_linear_lstsq` tomography fitters has been changed to accept
    a weights array the same shape as the supplied ``outcome_data`` array.
deprecations:
  - |
    The ``qubits``, ``measurement_qubits``, and ``preparation_qubits``
    init kwargs of :class:`~.StateTomography`,
    :class:`~.ProcessTomography`, and :class:`~.TomographyExperiment` have
    been deprecated. They have been replaced with kwargs ``physical_qubits``,
    ``measurement_indices`` and ``preparation_indices`` respectively. The
    renamed kwargs have the same functionality as the deprecated kwargs.
